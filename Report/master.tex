%\documentclass[11pt]{report}
%\usepackage[a4paper]{geometry}
\input{prelude}

%%%%%%%%%%%%%%%%%%
% BEGIN DOCUMENT %
%%%%%%%%%%%%%%%%%%

%\usepackage[final]{listings}

%\input{csvfiles}

\begin{document}

\maketitle
%\frontmatter
%\makedecl
\input{acknowledgement}
%\include{abstract}
%\mainmatter
%\setcounter{tocdepth}{3}
%\setcounter{secnumdepth}{3} dunno what this does.
{
  \hypersetup{linkcolor=black}
  \tableofcontents
  % Two times compilation
  %\listoffigures
  %\listoftables
   
}
\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Intro
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Introduction}
Railway companies need to continuously and sufficiently maintain the train tracks and optimally detect defects in order to have a more punctual and more effective train system. However, the current system is expensive, time consuming and ineffective. That is, maintenance agents need to walk along tracks and check them for defects. For visualisation purposes, there is roughly 5200 km of rails in Switzerland which needs to be inspected by 40 experienced inspectors.


"The condition assessment is evolving from a manual labour based approach to an industrialized assessment. This paradigm shift,.... (don't mention 40 inspectors, their job will in the future still be very important but at the office, checking false positives.)

In order to cope with this issue, \textit{Swiss Federal Railways} (SBB) has specifically built one special \textit{Diagnostic Vehicle} (Diagnosefahrzeug - DFZ) designed for defect detection and identification among other purposes. For this, accelerometers have been installed at the front and back of the DFZ to collect the signal responses from the wheel and the train track (see appendix \ref{figs:veh}).

A defect in train tracks can be seen as a discontinuity. As a train passes over this discontinuity, it will result in a perturbation that can be detected by sensors. It is our main assumption that each type of defect will have a specific signature that will allow its identification and classification. This is similar to the idea presented in \cite{Introduc31:online} about human activity recognition.

\section{Objective}
The objective of this project is to identify and classify rail surface defects. We aim to build an effective machine learning pipeline that takes information about defects as input and outputs a classification confidence for these defects. By succesfully identifying and classifying the defects, we take one step further towards reducing delays and making trains more punctual and reliable. In this development, the first step consists of identification and classification, while the second step ultimately consists of future defect prediction. 

toward a predictive maintenance which will result in a more reliable network [cite article about predictive maintenance]
\section{Defects}
A defect can be seen as a deviation from a standard train track; and can be further sub-categorized based on official defect documentation \cite{rail:online} provided by \textit{International Union of Railways} (UIC). Upon inspection of defective tracks, SBB inspectors reports defects with reference to the UIC-based, defect report document by SBB. An example of this can be seen in \ref{app:report}.
%Gleis	149.849086	(400, A-184063)	                  
%chienenzwischenlage	4.989620	(400, A-146358)	
%Bankett	1169.510537	(400, A-103213)
%Schwelle	0.000000	(400, A-103206)	
%Schwelle	0.000000	(400, A-118152)	
%Vignolschiene	0.000000	(400, A-231400)	
%Fahrbahn	0.000000	(400, A-233599)	
%First column is track types (object)

Generally, a defect is separated into two overarching types: range- and point-defects. I.e. a defect that is detected at a single point versus a defect that is detected at varying lengths. A point defect is perceived as a sharp signal response, whereas a range-defect is perceived over a greater time period. 
\begin{figure}[H]
	\centering
	%\includegraphics[width = 0.49\textwidth]{imgs/defs/p(400,A-103206)0}
	%\caption{Defect ID: A-$103206$; Report set ID: $400$}
	\includegraphics[width = 0.2\textwidth]{imgs/defs/p(400,A-118152)0}
	\includegraphics[width = 0.38\textwidth]{imgs/defs/p(400,A-231400)0}
	\includegraphics[width = 0.38\textwidth]{imgs/defs/p(400,A-233599)0}
	\caption{Left, middle, right: Schwelle (A-$118152$), Fahrbahn (A-$233599$), Vignolschiene (A-$231400$). The format is: track component (defect ID). These have all been reported as defects (with subcategories) with a length equals to zero, and thus have been classified as point defects using our terminology. (Source of pictures: SBB's defect report document)}
\end{figure}
\raggedbottom
\begin{figure}[H]
	\centering
	%\includegraphics[width = 0.49\textwidth]{imgs/defs/p(400,A-103206)0}
	%\caption{Defect ID: A-$103206$; Report set ID: $400$}
	\includegraphics[width = 0.31\textwidth]{imgs/defs/r(400,A-184063)0}
	\includegraphics[width = 0.31\textwidth]{imgs/defs/r(400,A-184063)1}
	
	\includegraphics[width = 0.31\textwidth]{imgs/defs/r(400,A-146358)0}
	\includegraphics[width = 0.31\textwidth]{imgs/defs/r(400,A-146358)1}
\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[width = 0.31\textwidth]{imgs/defs/r(400,A-103213)0}
	\caption{Top, middle, bottom: Gleis-$149.8 m$ (A-$184063$), Schienenzwischenlage-$5.0 m$ (A-$146358$), Bankett-$1169.5 m$ (A-$231400$). The format is: track component-length (defect ID). These have all been reported as defects (with subcategories) with a length strictly greater than zero, and thus have been classified as range defects using our terminology. Most of these range defects have two pictures likely to give more detail. (Source of pictures: SBB's defect report document)}
\end{figure}
\raggedbottom % to get of unnecessary vertical spacing

For this project, only the point defects are subject to analysis, as this simplifies the problem statement; range-defects and its associated factors are thus disregarded. In the future, range defects naturally also need to be taken into account.

\section{Switches and insulation joints}

\begin{figure}[H]
	\centering
	\includegraphics[width = 0.49\textwidth]{imgs/switch0}
	\includegraphics[width = 0.49\textwidth]{imgs/switch1}
	\caption{(Picture sources from right to left: \cite{swi0:online}, \cite{swi1:online})}
\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[width = 0.49\textwidth]{imgs/ins_joint0}
	\includegraphics[width = 0.49\textwidth]{imgs/ins_joint1}
	\caption{(Picture sources from right to left: \cite{ins0:online}, \cite{ins1:online})}
\end{figure}

In this report, we will use the word 'entity' as an umbrella term for the different track entities: switch, insulation joint and defect.

\section{Data}
The data has been collected and provided by SBB. Using their DFZ, SBB has made trips back and forth to different cities in Switzerland in order to collect various data including but not limited to accelerometer data. After the data collection, the data is imported into a Python-VR object, which is composed of \verb|pandas| \verb|DataFrames|. \verb|Python| objects with pandas \verb|DataFrames| were chosen for their functional flexibility in terms of data storage and data accessibility.

The accelerometers capture the accelerations at the vertical (Z) and transversal (Y) axes (along with the timestamps at each recording), of which, only the Z axis was considered, as it is assumed to be the most responsive to vertical perturbations. These accelerometers are installed on both leading (axle 1) and trailing axles (axle 4) of the measurement coach. See appendix \ref{figs:veh} for visualisations of the accelerometer placements on the DFZ. 

In this work, we are using the DFZ measurement rides in table \ref{tab:rides} for classification.

%new_filenames = ['__new_gDFZ_2019-05-27T08_55_55_819Z_DFZ01', # s - 819Z_DFZ01
%                 '__new_gDFZ_2019-05-27T10_03_59_077Z_DFZ01', # t - 077Z_DFZ01
%                 '__new_gDFZ_2019-05-27T13_05_53_330Z_DFZ01', # u - 330Z_DFZ01
%                 '__new_gDFZ_2019-05-27T14_10_51_425Z_DFZ01'] # v - 425Z_DFZ01
\begin{table}[H]
	\centering
	\begin{tabular}{|c|c|c|c|} \hline
		\textbf{From} & \textbf{To} & \textbf{Date} & \textbf{Campaign ID}\\ \hline \hline 
		- & - &  \verb|2019-05-27T08_55_55| & \verb|819Z DFZ01| \\ \hline 
		- & - &  \verb|2019-05-27T10_03_59| & \verb|077Z DFZ01| \\ \hline 
		- & - &  \verb|2019-05-27T13_05_53| & \verb|330Z DFZ01| \\ \hline 
		- & - &  \verb|2019-05-27T14_10_51| & \verb|425Z DFZ01| \\ \hline 
	\end{tabular}
	\caption{Measurement rides for classification}
	\label{tab:rides}
\end{table}

Lastly, defect attributes and locations were retrieved from SBB's database and synchronized with the measurement data.

\section{Code}
\label{int:sec:code}
The code is written purely in python. To create neural network architectures, we are using: \verb|keras| along with \verb|tensorflow|. \verb|keras| is essentially a high-level neural networks library which runs on top of \verb|tensorflow|. It has a consistent, simple API and provides clear and actionable feedback upon user error. Models are easily made by connecting configurable building blocks together, with few restrictions \cite{TensorFl31:online}. The models were trained in \verb|Google Colab|, which is a web application provided by Google that enables users to run python code in the web browser with access to GPUs\footnote{\url{https://colab.research.google.com/notebooks/intro.ipynb}}. It is very similar to \verb|Anaconda's| \verb|Jupyter Notebooks|, except that \verb|Colab| runs in the browser, is collaborative and provides free usage of GPUs (meaning model training goes faster).\\


\noindent All the code can be found on github: \\
\url{https://github.com/Aiyualive/SemesterProject2.0}.\\

\noindent The specific model execution workflow can be found \verb|Colab|:\\
\url{https://colab.research.google.com/drive/12VBz_KrJxeyR_pjpkC87fewv5aMSEI5_}

keras version number, pandas version number, tensorflow version nmber


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Design and implementation
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Design and Implementation}
For the process of defect classification the pipeline in figure \ref{fig:pipeline} was designed. In the next sections, an overview will be given of how each step was implemented.
\begin{figure}[H]
	\centering
	\includegraphics[width = \textwidth]{imgs/pipeline}
	\caption{Primary pipeline}
	\label{fig:pipeline}
\end{figure}


%--> reevaluation| Realised that the results were not very good. So we need to visualise the data and look for separability to make a better model

2.0 Localization of the vehicle:

The vehicle is localized using the combination of multiple data streams: track transponders (Eurobalise) GPS signals, Odometers and Switch detection systems. The reported localization error has been determined to be quite small.

\section{Shift of GPS timestamps}
The location is reported with respect to the GPS Antenna of the vehicle which is close to the pantograph. The location is reported along with a timestamp corresponding to the location of the vehicle at that time at the locatio nof the antenna. \todo{todo}

The SDV has its GPS sensor installed at a specified location on the vehicle body. However, what we need to achieve is the position (covered distance) at each accelerometer at either sides of the GPS. Since the GPS sensor is sampled at a lower frequency compared to the accelerometers (every $25$ cm vs $24$ kHz respectively), we first need to get the corresponding positions for each accelerometer sample. This is done by linear interpolation using the timestamps of the accelerometers and GPS. 

Depending on the direction of the vehicle, the offset between the accelerometers and the GPS sensor positions on the vehicle body is added/subtracted.\todo{todo}

\section{Peak windows}
Retrieving the signal response around the defect location forms a crucial aspect in the overarching pipeline. The goal of this step is to, around each defect, create a "window" containing accelerometer accelerations of a specified time length -- wherein Within the highest acceleration recording around is found in the center. As a result, all of these windows would be uniform in the sense that they are all centered according to the highest recording of a defect. It is then assumed that each window forms the signature of each track entity. 

Since we are assuming that each track entity is identified by a well-formed peak, we first need to find this peak within a reasonable offset from the defect location, after which we center around that within another reasonable offset. 

In the code, this is done by defining two parameters: \verb|find_peak_offset = 1| and \verb|window_offset = 0.5|. I.e. given a defect timestamp, we search for the highest acceleration recording that has occured $1$ second after and $1$ second before the defect timestamp. Once the peak has been found, we then center it in a $1$ second window ($0.5$ sec on each side).

the window offset can be very small (as small as possible without losing the peaks). Otherwise you will merge too many peaks using the peakfinder. 0.5 of even 0.1 should be ok. 

peakfinder does not consider the opposite end of the peaks



\section{Entity library}
The peak windows arguably forms the central feature of the defect library. However, based on domain knowledge, other features like vehicle speed also needs to be considered for our neural network. Apart from the peak windows, we have likewise extracted other relevant features that might be useful for classifcation:
%timestamps	accelerations	window_length(s)	severity	vehicle_speed(m/s)	axle	campagin_ID	driving_direction	ID	class_labe
%timestamps	accelerations	window_length(s)	severity	vehicle_speed(m/s)	axle	campagin_ID	driving_direction	defect_type	defect_length(m)	line, defect_ID	class_label
\begin{itemize}
	\item \textbf{Timestamps:} timestamps for the sampled acceleration
	\item \textbf{Acceleration:} sampled acceleration at axle box.
	\item \textbf{Vehicle speed (m/s):} vehicle speed at the closest timestamp
	\item \textbf{Severity:} Urgency of the entity; defects have an urgency label signifying how much time is left before acting; labels $1,2,3,4$, where urgency decreases in ascending order. Insulation joints and switches have been self-engineered with label $5$ -- all entities need to have the same feature column for training.
\end{itemize}
Additional information about each entity has been retrieved as well, such as: driving direction, corresponding entity IDs etc. For each entity, we crucially set a true, class label such that we are able to do supervised learning.

Given a specific measurement ride object, we either retrieve each feature directly from the corresponding \verb|dataframe| or with the use of designated helper functions for those requring extra processing. Currently, we have have a 2-level nested \verb|for loop|, looping for each axle outerly, and looping for each entity entry innerly.

The implementation of this could have made more elegant by operating directly on the dataframe, which might also increase speed of the implementation as the \verb|pandas| library has optimised their dataframe operations. The However, speed and efficency was not a major concern in this project. 

%refer to the defects presented in introduction,  appendix for more signals?
% show two of each entity and for each axle.
\begin{figure}[H]
	\centering
	%\includegraphics[width = 0.49\textwidth]{imgs/defs/p(400,A-103206)0}
	%\caption{Defect ID: A-$103206$; Report set ID: $400$}
	\includegraphics[width = 0.31\textwidth]{imgs/defs/r(400,A-184063)0}
	\includegraphics[width = 0.31\textwidth]{imgs/defs/r(400,A-184063)1}
	\includegraphics[width = 0.31\textwidth]{imgs/defs/r(400,A-184063)0}
	\includegraphics[width = 0.31\textwidth]{imgs/defs/r(400,A-184063)1}
	\caption{Defects}
\end{figure}

\section{Classification}
We have created a primary \verb|NN| class (short for neural network) along with a \verb|ModelMaker| class. The former does everything from pre-processing the data to evaluating the used model. The latter, as the name suggests, is utlised for creating and using different models, which is useful as we can keep track of how the models have been modified and improved. 

\subsection{NN class}
To make a classification, we first need to select the relevant features. Then we simply feed the features into an \verb|NN| object, where the API of the \verb|NN| class can be called for classification. The usage of the \verb|NN| class is demonstrated below in \ref{tab:nnclass}.


\begin{table}[H]
	\centering
	\small
	\begin{tabular}{l p{0.5\linewidth}}\noalign{\global\arrayrulewidth=0.3mm} 
	\hline 
	\multicolumn{2}{c}{\textbf{API of NN class}}
		\\ \hline  
		\noalign{\global\arrayrulewidth=0.05mm}
		\verb|__init__()|                  & initialises a \verb|NN| object\\ \hline
		\verb|prepare_data()|            & pre-process data, this includes standardisation of data\\ \hline
		\verb|make_model()|              & uses \verb|ModelMaker| class to select a model \\ \hline
		
		\verb|fit()|			         & trains the model\\ \hline
		\verb|classify()|			     & uses the trained model to classify on a test set\\ 
		\noalign{\global\arrayrulewidth=0.3mm} \hline 

		\vspace*{0.25cm}\\
		\hline
		\multicolumn{2}{c}{ \textbf{Other utility API functions} }	
		\\ \hline 
		\noalign{\global\arrayrulewidth=0.05mm}
		\verb|measure_performance()| & currently only on validation data \\ \hline
		\verb|plot_metrics()|          \\  \hline
		\verb|plot_confusion_matrix()| \\ \hline
		\verb|load_weights()|             \\ \hline
		\verb|load_model_()|             \\ \hline
		\verb|save_history()|           \\ \hline
		\verb|save_model()|              \\ \hline
		\verb|save_classification_to_csv()|  \\ \hline
		\noalign{\global\arrayrulewidth=0.3mm}
		\hline \hline
		\verb|run_experiment()| & evaluates the given model for a \# of repetitions\\ 
		\noalign{\global\arrayrulewidth=0.3mm}
		\hline
	\end{tabular}
	\caption{To train a model, the first API functions needs to be called sequentially. Other utility functions are rather self-explanatory.}\label{tab:nnclass}
\end{table}
\raggedbottom % To get rid of weird spacing

\subsection{ModelMaker class}
As mentioned in the introduction \ref{int:sec:code}, this is where we make use of \verb|keras|.

epochs, batch size

conv 1 d,

kernel size

filter

flatten

dropout

sequential model

maxpooling

dense

loss

learning rate

activation functions

shape

See example of this in next chapter. 

callbacks - when training

\section{Visualisation}
Finally, after evaluating the results (results can be seen in the next section) from the neural network, we have not achieved any significant results. Arguably, the visualisations of class separability should have been handled first. However, the previous steps took the majority of the time.

using PCA

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Evaluation
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Evaluation}
Here we will present the results and discuss the findings herein.


\section{Models}
\begin{table}[H]
	\centering
	\begin{tabular}{|c|c|c| c|} \hline
		\textbf{Layer} & \textbf{Output Shape } & \textbf{Number of params} \\ \hline \hline 
		- & - &  -  \\ \hline 
	\end{tabular}
	\caption{Model 1}
	\label{datasets}
\end{table}

Draw models \url{http://alexlenail.me/NN-SVG/AlexNet.html} \todo{do one model at a time}

\section{Model evaluations}

\begin{table}[H]
	\centering
	\begin{tabular}{|c|c|c|} \hline
		\textbf{Defect} & $2$ & $ \%$\\ \hline
	\end{tabular}
	\caption{Entity distribution, class distributions}
\end{table}

In this section we evaluate our model with regard to a variety of metrics: loss (\textbf{L}), accuracy (\textbf{ACC}), true positives (\textbf{TP}), false positives (\textbf{FP}), true negatives (\textbf{TN}), false negatives (\textbf{FN}), precision (\textbf{P}), recall (\textbf{R}), area under the curve (\textbf{AUC}).
%&{L}&{ACC}&{TP}&{TN}&{FP}&{FN}&{P}&{R}&{AUC}
\begin{table}[H]
		\centering 
		\begin{tabular}{|l||*{5}{c|}}\hline
			\backslashbox{Metric}{Model}
			&\makebox[6.3em]{Model 1}&\makebox[6.3em]{}&\makebox[6.3em]{}&\makebox[6.3em]{} 
			\\\hline\hline
			L   & $-$ & $-$ & $-$ & $-$ \\ \hline
			ACC & $-$ & $-$ & $-$ & $-$ \\ \hline
			TP  & $-$ & $-$ & $-$ & $-$ \\ \hline
			FP  & $-$ & $-$ & $-$ & $-$ \\ \hline
			TN  & $-$ & $-$ & $-$ & $-$ \\ \hline
			FN  & $-$ & $-$ & $-$ & $-$ \\ \hline
			P   & $-$ & $-$ & $-$ & $-$ \\ \hline
			R   & $-$ & $-$ & $-$ & $-$ \\ \hline
			AUC & $-$ & $-$ & $-$ & $-$ \\ \hline
			\Xhline{3\arrayrulewidth} 
			Relative diff? & $-$ & $-$ & $-$ & $-$ \\ \hline 
		\end{tabular}
		\captionof{table}{Average metrics times and their standard deviations in parenthesis - rel diff?}
		\label{tab:resBenchmark}
\end{table} 


\textbf{intermediate results}
\begin{verbatim}
Results model 1, only defects, new dataset
>>> Summarize results <<<
Overall loss: 2.969% (+/-0.009)
Overall acc: 0.074% (+/-0.014)
Overall true_positives_10: 0.300% (+/-0.458)
Overall fp: 0.600% (+/-0.917)
Overall tn: 3609.400% (+/-0.917)
Overall fn: 189.700% (+/-0.458)
Overall precision: 0.175% (+/-0.317)
Overall recall: 0.002% (+/-0.002)
Overall auc: 0.568% (+/-0.007)

Results model 1, only ins joints and switches, new dataset
>>> Summarize results <<<
Overall loss: 0.691% (+/-0.001)
Overall acc: 0.587% (+/-0.000)
Overall true_positives_11: 155.000% (+/-0.000)
Overall fp: 109.000% (+/-0.000)
Overall tn: 155.000% (+/-0.000)
Overall fn: 109.000% (+/-0.000)
Overall precision: 0.587% (+/-0.000)
Overall recall: 0.587% (+/-0.000)
Overall auc: 0.572% (+/-0.031)
\end{verbatim}

\section{Visualisation of class clustering}
insert the pca plots

\section{Discussion}
Data amount, circumvent: could self-engineer data. 

should have done visualisation first, if we have clear cluster separation, applying a neural network would be a bit exaggerated. And in that case, we could opt for a simple multi class support vector machine from the \verb|sklearn| library. However, using \verb|tensorflow| was the plan from the get-go as it is more industrially-applicable, so we disregarded simpler methods.

ensure that data is uniform. That is, some of the data has calibration and some hasnt. 

more sophisticated use of features.

Look more into defect types, its specifics

Sometimes the defect can only be detected from one side of the track -- AX11 and AX12 as one defect crossing sample with two signatures seen from different location. This would help in cases where the defect is only on one side of the track.

Many a times the validation set is used as the test set, but it is not good practice. The test set is generally well curated. It contains carefully sampled data that spans the various classes that the model would face, when used in the real world.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Conclusion and future work
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Conclusion and future work}

%%% CONCLUSION
\section{Conclusion}
Results were quite mediocre, but has a lot of room for improvement. I am sure that given more time I would be able to explore and evaluate the results further.

how good is the foundation to move onwards with further research

library code is built in an extensible form

overlap between switch and insulation joints

You are on tracks which are "brand new- built in 2006-2018".  so the defects are all minor. The new measurement data we recently got would work much much better since they drove on pretty bad bad bad stuff :)

%%% FUTURE WORK
\section{Future work}
There is still a lot of work that needs to be done in this project. These are summarised in the next sub-sections -- in no particular order. 

\subsection{Channels}
It might be interesting to consider sensor fusion of the ZY axes and the axle channels (8 total channels). The transverse axis, Y, would especially be valuable for switches as this channel can pick up sideways hits in the case of switches. These switch signals are clearly different from that of the other entities and may thus be easily separable.
	
In this project, only the accelerometer accelerations at the axle-boxes were considered. However, the other accelerometer sensors higher up in the vehicle: bogie(Z, Y) and body (Y) (see appendix \ref{figs:veh}), will also be worth analyzing.

\subsection{Peak windows}
we must not set the findpeakoffset too high

track entity dependent/specific window offsets

tune the peak finding parameters

\subsection{Identification of infrastructure}
%To better identify infrastructure components and damages (entities), the order and distance between entities should be considered, as well as the uncertainty in the reported location of the entities themselves (databases are not always mm accurate) as well as the uncertainty in the reported location of the vehicle).
%Expected from layout: "...I....S,I,....Weld,....I,..............I,...S,..W,.."
%Measured hits: "...I..S,...I,...Weld,...I,......I...,...S,..W,.."
	
\subsection{Real-world simulated defects}
I have participated in ETH Hatchery \footnote{\url{https://sph.ethz.ch/eth-week-hatchery/}}, where our team built a prototype with a model train. We let the model train drive on the track with self-engineered defects. 


\newpage
\section{TODO}
\begin{itemize}
	\item add speed as a feature
	\item visualise what the network is doing using Harry's code
	\item Which type of defects are we actually working with, we can see that it does okay at the switches and ins joints, but no chance with the defects
	\item concat all the axle channels and train on them
	\item try to use low pass filter - (would make everything faster)
	\item get better results
	\item account for severity
	\item You can put more citations, for example about some articles focusing on recognizing speech/sound, signals which have also very similar signatures
	\item add description for the defects?
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Bibliography
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bibliography{master}
%more would be good. and not only blogposts. 
%--> Machine Learning and Pattern Recognition book (the one that is probably also used inthe Deep learning class that you took).
%--> Railway-vehicle dynamics by Knothe,
%--> UIC defect catalog which SBB uses as a base for classifying the defects
%--> Some scientific articles on sound recognition/voice


\newpage
\cleardoublepage
\appendix
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Appendix introduction
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Introduction}
\section{List of defect categories}
\begin{table}[H]
	\centering
	\begin{tabular}{|c|} \hline
		Bankett  \\ \hline 
		Befestigung \\ \hline
		Dienstweg \\ \hline
		Entwässerungsgraben \\ \hline
		Fahrbahn \\ \hline
		Gleis \\ \hline
		Gleisbettung \\ \hline
		Herzstück \\ \hline
		Herzstückspitze \\ \hline
		Kleber \\ \hline
		Schiene \\ \hline
		Schienenzwischenlage \\ \hline
		Schotter \\ \hline
		Schweissverbindung \\ \hline
		Schwelle \\ \hline
		Stockschiene \\ \hline
		Vignolschiene \\ \hline
		Weiche \\ \hline
		Zungenschiene \\ \hline
	\end{tabular}
	\caption{Defect categories}
\end{table}

\section{Vehicle and accelerometer placements}
\label{figs:veh}
\begin{figure}[H]
	\centering
	\includegraphics[width = 0.58\textwidth]{imgs/veh0}
	\label{fig:veh0}
	
	\includegraphics[width = 0.58\textwidth]{imgs/veh1}
	\label{fig:veh1}
	
	\includegraphics[width = 0.58\textwidth]{imgs/veh2}
	\caption{Illustrations of the accelerometer placements on the DFZ. For this project we have only considered axle number 4 in the third figure. (Source of picture: SBB documents)}
	\label{fig:veh2}
\end{figure}

\section{SBB defect report example}
\label{app:report}
\begin{figure}[H]
	\centering
	\includegraphics[width = 0.9\textwidth]{imgs/defs/rep0}
	\caption{}
	\includegraphics[width = 0.9\textwidth]{imgs/defs/rep1}
	\caption{A typical report for an arbitrary defect usually contains one description page followed by its picture(s)}
	\label{fig:veh2}
\end{figure}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Appendix Implementation
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Implementation}
%\foreach \n in {0,1,2,3,4,5,6,7,9}{
%	\begin{figure}[H]
%	\foreach \k in {0,1,2,3,4,5,6,7,8,9}{
%		\ifnum\n=\k
%		\else
%		\begin{subfigure}[b]{0.19\textwidth}
%			\centering
%			\includegraphics[width=\textwidth]{../Cleaning/wekapics/WEKAmnist_all2000CLASS\n_\k}
%			\caption{Class \n vs\k}
%			\label{class_\n\k}
%		\end{subfigure}
%		\fi
%		}
%	\caption{Comparisons with Class \n}
%	\end{figure}
%	\ifoddpage
%		\clearpage
%	\else
%	\fi
%}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Appendix Evaluation
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Evaluation}
\begin{table}[H]
	\centering
\begin{tabular}{|l|ccccccccc|}
	\hline
	\backslashbox{run \#}{Metrics}
&{L}&{ACC}&{TP}&{TN}&{FP}&{FN}&{P}&{R}&{AUC} \\\hline\hline
	1 & $-$ & $-$ & $-$ & $-$ & $-$ & $-$ & $-$ & $-$ & $-$ \\ \hline
\end{tabular}
	\caption{Experiment result of 10 runs}
\end{table}

confusion matrix, epoch plots

%\foreach \n in {0,1,2,3,4,5,6,7,9}{
%	\begin{figure}[H]
%	\foreach \k in {0,1,2,3,4,5,6,7,8,9}{
%		\ifnum\n=\k
%		\else
%		\begin{subfigure}[b]{0.19\textwidth}
%			\centering
%			\includegraphics[width=\textwidth]{../Cleaning/wekapics/WEKAmnist_all2000CLASS\n_\k}
%			\caption{Class \n vs\k}
%			\label{class_\n\k}
%		\end{subfigure}
%		\fi
%		}
%	\caption{Comparisons with Class \n}
%	\end{figure}
%	\ifoddpage
%		\clearpage
%	\else
%	\fi
%}

%\begin{table}[H]
%	\centering
%	\begin{tabular}{|c|c|} \hline
%		\textbf{Latent Dimension} & $2$ \\ \hline
%		\textbf{Shape} & 8 $\times$ $8$ \\ \hline
%		\textbf{Latent s} &  $64$\\ \hline
%		\textbf{Dist. Mixtures} &  Bernoulli\\ \hline \hline
%		\textbf{Regularisation $\alpha$ } & $0.001$ \\ \hline
%	\end{tabular}
%	\hspace*{0.5cm}
%	\begin{tabular}{|l|c|} \hline
%		\textbf{RBF Dimension} & $2$ \\ \hline
%		\textbf{RBF grid}  & $4\times4$ \\ \hline 
%		\textbf{RBF centres} & $16$ \\ \hline
%		\textbf{Basis function} & Gaussian \\ \hline
%	    \textbf{Widths $\bm{\sigma}$} & $1.0$\\ \hline
%	\end{tabular}
%	\caption{The parameters for the latent model and the RBF neural network. Distribution mixtures and basis functions cannot be altered as our implementation is specific for the Bernoulli GTM version}
%	\label{eval:model}
%\end{table}
\end{document}
